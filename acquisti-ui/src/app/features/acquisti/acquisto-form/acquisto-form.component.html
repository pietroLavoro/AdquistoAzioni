<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem">
  <!-- Columna izquierda: formulario -->
  <div>
    <form
      [formGroup]="form"
      (ngSubmit)="doPreview()"
      style="display: grid; gap: 0.75rem; max-width: 480px"
    >
      <label
        >Código Título
        <select formControlName="titoloCodice">
          <option value="ENEL2025">ENEL2025 - Obbligazione ENEL 2025</option>
          <option value="ENI2024">ENI2024 - Obbligazione ENI 2024</option>
          <!-- añade más si tienes -->
        </select>
      </label>

      <label
        >Fecha (yyyy-MM-dd)
        <input type="date" formControlName="dataCompra" />
      </label>

      <label
        >Importe total
        <input type="number" formControlName="importoTotale" />
      </label>

      <label
        >Cantidad total
        <input type="number" formControlName="quantitaTotale" />
      </label>

      <div style="display: flex; gap: 0.5rem">
        <button type="submit">Previsualizar</button>
        <button type="button" (click)="sugerirFecha()">Sugerir fecha</button>
        <button type="button" (click)="verAgentesActivos()">Ver agentes activos</button>
        <button type="button" (click)="resetSaldos()">Reset saldos</button>
      </div>

      <p *ngIf="error" style="color: red">Error: {{ error }}</p>
    </form>

    <!-- si ya tenías preview, aquí lo presentas como antes -->
  </div>

  <!-- Columna derecha: paneles de referencia -->
  <div>
    <h3>Agentes activos a la fecha</h3>
    <p *ngIf="agentiInfo as ai">
      Fecha: {{ ai.data }} — Activos: <b>{{ ai.numAgenti }}</b>
    </p>
    <table *ngIf="agentiInfo?.agenti?.length" border="1" cellpadding="3" cellspacing="0">
      <thead>
        <tr>
          <th>ID</th>
          <th>CF</th>
          <th>Saldo disp.</th>
        </tr>
      </thead>
      <tbody>
        <!-- tabla agentes activos a la fecha -->
        <tr *ngFor="let a of agentiInfo?.agenti">
          <td>{{ a.id }}</td>
          <td>{{ a.codiceFiscale }}</td>
          <td>{{ a.saldoDisponibile | number : '1.2-2' }}</td>
        </tr>
      </tbody>
    </table>

    <h3 style="margin-top: 2rem">Saldos en tiempo real (todos)</h3>
    <small>Actualiza cada {{ pollingMs / 1000 }}s</small>
    <table border="1" cellpadding="3" cellspacing="0" style="margin-top: 0.5rem">
      <thead>
        <tr>
          <th>ID</th>
          <th>CF</th>
          <th>Saldo disp.</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let a of saldiLive">
          <td>{{ a.id }}</td>
          <td>{{ a.codiceFiscale }}</td>
          <td [style.color]="a.saldoDisponibile >= 0 ? 'inherit' : 'crimson'">
            {{ a.saldoDisponibile | number : '1.2-2' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Panel derecho: saldos en tiempo real -->
<section>
  <h3>Agentes (saldos en vivo)</h3>
  <button type="button" (click)="resetSaldos()">Reiniciar saldos (testing)</button>
  <table *ngIf="saldiLive?.length">
    <thead>
      <tr>
        <th>ID</th>
        <th>CF</th>
        <th>Saldo disp.</th>
      </tr>
    </thead>
    <tbody>
      <!-- tabla saldos en vivo -->
      <tr *ngFor="let a of saldiLive">
        <td>{{ a.id }}</td>
        <td>{{ a.codiceFiscale }}</td>
        <td>{{ a.saldoDisponibile | number : '1.2-2' }}</td>
      </tr>
    </tbody>
  </table>
</section>
